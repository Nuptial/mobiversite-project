import Link from "next/link";

import CartNavLink from "../components/cart-nav-link";
import HeaderBar from "../components/header-bar";
import LogoutButton from "../components/logout-button";
import MobileNavigation from "../components/mobile-navigation";
import { getCurrentUser } from "../lib/auth";
import "./globals.css";
import Providers from "./providers";

const Logo = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="125"
    height="20"
    viewBox="0 0 187 25"
    fill="none"
    className="h-5 w-auto text-neutral-900 sm:h-6"
    role="img"
    aria-label="Mobiversite"
  >
    <mask
      id="mask0"
      style={{ maskType: "luminance" }}
      maskUnits="userSpaceOnUse"
      x="29"
      y="0"
      width="158"
      height="23"
    >
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M60.5013 6.90404C62.7039 6.90404 64.5642 7.65808 66.0821 9.16613C67.6001 10.6742 68.3591 12.5295 68.3591 14.7321C68.3591 16.9346 67.6001 18.7899 66.0821 20.298C64.5642 21.8061 62.7039 22.5601 60.5013 22.5601C58.3186 22.5601 56.4633 21.8061 54.9354 20.298C53.4075 18.7899 52.6435 16.9346 52.6435 14.7321C52.6435 12.5295 53.4075 10.6742 54.9354 9.16613C56.4633 7.65808 58.3186 6.90404 60.5013 6.90404ZM74.4906 1.33811V9.40425L74.5505 9.32294C75.7581 7.71034 77.4743 6.90404 79.6993 6.90404C81.7431 6.90404 83.4893 7.65808 84.9379 9.16613C86.3864 10.6742 87.1107 12.5295 87.1107 14.7321C87.1107 16.9148 86.3864 18.7651 84.9379 20.2831C83.4893 21.8011 81.7431 22.5601 79.6993 22.5601C77.4372 22.5601 75.701 21.7168 74.4906 20.0301V22.1732H71.276V1.33811H74.4906ZM119.613 6.90404C121.796 6.90404 123.587 7.66799 124.986 9.1959C126.385 10.7238 127.084 12.5791 127.084 14.7618C127.084 15.0992 127.044 15.5456 126.965 16.1012H115.119L115.141 16.2003C115.389 17.2831 115.928 18.1182 116.756 18.7056C117.609 19.3108 118.651 19.6134 119.881 19.6134C121.588 19.6134 122.868 18.9983 123.721 17.768L126.37 19.3158L126.309 19.4041C124.842 21.5081 122.689 22.5601 119.851 22.5601C117.431 22.5601 115.476 21.8209 113.988 20.3426C112.5 18.8644 111.756 16.9942 111.756 14.7321C111.756 12.5097 112.49 10.6494 113.958 9.15125C115.426 7.65311 117.312 6.90404 119.613 6.90404ZM145.151 6.90404C146.381 6.90404 147.478 7.17688 148.44 7.72256C149.402 8.26825 150.142 9.02724 150.658 9.99954L147.949 11.5175L147.918 11.4516C147.396 10.3645 146.474 9.82095 145.151 9.82095C144.536 9.82095 144.02 9.95489 143.603 10.2228C143.187 10.4906 142.978 10.8825 142.978 11.3985C142.978 11.8945 143.251 12.2864 143.797 12.5742C144.343 12.8619 145.007 13.1099 145.791 13.3183C146.575 13.5266 147.364 13.7697 148.157 14.0475C148.951 14.3253 149.621 14.7965 150.166 15.4613C150.712 16.126 150.985 16.9644 150.985 17.9764C150.985 19.4051 150.434 20.5262 149.333 21.3398C148.232 22.1533 146.848 22.5601 145.181 22.5601C143.713 22.5601 142.453 22.2525 141.401 21.6374C140.349 21.0223 139.585 20.169 139.109 19.0777L141.877 17.4704L141.904 17.5424C142.43 18.9231 143.523 19.6134 145.181 19.6134C146.868 19.6134 147.711 19.0578 147.711 17.9466C147.711 17.4704 147.438 17.0835 146.892 16.7858C146.347 16.4882 145.682 16.2352 144.898 16.0268C144.114 15.8185 143.326 15.5754 142.532 15.2976C141.738 15.0198 141.068 14.5584 140.523 13.9135C139.977 13.2687 139.704 12.4501 139.704 11.458C139.704 10.0888 140.225 8.98755 141.267 8.15415C142.309 7.32074 143.603 6.90404 145.151 6.90404ZM179.142 6.90404C181.325 6.90404 183.116 7.66799 184.514 9.1959C185.913 10.7238 186.613 12.5791 186.613 14.7618C186.613 15.0992 186.573 15.5456 186.494 16.1012H174.648L174.669 16.2003C174.918 17.2831 175.456 18.1182 176.285 18.7056C177.138 19.3108 178.18 19.6134 179.41 19.6134C181.116 19.6134 182.396 18.9983 183.249 17.768L185.899 19.3158L185.838 19.4041C184.37 21.5081 182.218 22.5601 179.38 22.5601C176.959 22.5601 175.005 21.8209 173.517 20.3426C172.028 18.8644 171.284 16.9942 171.284 14.7321C171.284 12.5097 172.018 10.6494 173.487 9.15125C174.955 7.65311 176.84 6.90404 179.142 6.90404ZM165.361 3.12397V7.29098H169.052V10.3865H165.361V17.5299L165.362 17.6059C165.373 18.1815 165.512 18.5977 165.778 18.8544C166.056 19.1223 166.467 19.2711 167.013 19.3009C167.559 19.3307 168.238 19.3257 169.052 19.286V22.1732L168.923 22.1883C166.53 22.4632 164.807 22.2448 163.754 21.5332C162.682 20.8089 162.147 19.4745 162.147 17.5299V10.3865H159.408V7.29098H162.147V4.07643L165.361 3.12397ZM33.267 1.33811L39.5472 11.7556L45.8573 1.33811H49.5183V22.1732H46.0954V7.32074L39.7556 17.7978H39.3389L32.9991 7.29098V22.1732H29.5762V1.33811H33.267ZM93.2421 7.29098V22.1732H90.0276V7.29098H93.2421ZM98.7485 7.29098L102.916 18.6014L107.053 7.29098H110.565L104.761 22.1732H101.04L95.2363 7.29098H98.7485ZM137.71 7.0231V10.5055L137.602 10.4995C136.417 10.4437 135.381 10.7384 134.496 11.3836C133.583 12.0483 133.126 13.1446 133.126 14.6725V22.1732H129.912V7.29098H133.126V9.79118L133.163 9.70917C133.986 7.91846 135.501 7.0231 137.71 7.0231ZM157.027 7.29098V22.1732H153.813V7.29098H157.027ZM79.1933 9.96977C77.844 9.96977 76.7229 10.4212 75.83 11.324C74.937 12.2269 74.4906 13.3629 74.4906 14.7321C74.4906 16.1012 74.937 17.2422 75.83 18.155C76.7229 19.0479 77.844 19.4944 79.1933 19.4944C80.5427 19.4944 81.6638 19.0429 82.5567 18.1401C83.4496 17.2372 83.8961 16.1012 83.8961 14.7321C83.8961 13.3629 83.4496 12.2269 82.5567 11.324C81.6638 10.4212 80.5427 9.96977 79.1933 9.96977ZM60.5013 10.0293C59.1917 10.0293 58.0904 10.4758 57.1975 11.3687C56.3046 12.2616 55.8581 13.3827 55.8581 14.7321C55.8581 16.0814 56.3046 17.2025 57.1975 18.0954C58.0904 18.9884 59.1917 19.4348 60.5013 19.4348C61.811 19.4348 62.9122 18.9884 63.8052 18.0954C64.6981 17.2025 65.1446 16.0814 65.1446 14.7321C65.1446 13.3827 64.6981 12.2616 63.8052 11.3687C62.9122 10.4758 61.811 10.0293 60.5013 10.0293ZM119.584 9.82095C118.393 9.82095 117.401 10.1484 116.607 10.8032C115.813 11.458 115.307 12.3509 115.089 13.482H123.84C123.622 12.2716 123.121 11.3588 122.337 10.7436C121.553 10.1285 120.635 9.82095 119.584 9.82095ZM179.112 9.82095C177.922 9.82095 176.93 10.1484 176.136 10.8032C175.342 11.458 174.836 12.3509 174.618 13.482H183.369C183.15 12.2716 182.649 11.3588 181.865 10.7436C181.082 10.1285 180.164 9.82095 179.112 9.82095ZM91.6348 0.951172C92.2103 0.951172 92.6964 1.15457 93.0933 1.56134C93.4902 1.96811 93.6886 2.44932 93.6886 3.00491C93.6886 3.56051 93.4802 4.04666 93.0635 4.46337C92.6667 4.86023 92.1904 5.05865 91.6348 5.05865C91.0792 5.05865 90.598 4.85526 90.1913 4.44848C89.7845 4.04171 89.5811 3.56051 89.5811 3.00491C89.5811 2.44932 89.7795 1.96811 90.1764 1.56134C90.5733 1.15457 91.0594 0.951172 91.6348 0.951172ZM155.42 0.951172C155.995 0.951172 156.481 1.15457 156.878 1.56134C157.275 1.96811 157.474 2.44932 157.474 3.00491C157.474 3.56051 157.265 4.04666 156.849 4.46337C156.452 4.86023 155.975 5.05865 155.42 5.05865C154.864 5.05865 154.383 4.85526 153.976 4.44848C153.569 4.04171 153.366 3.56051 153.366 3.00491C153.366 2.44932 153.565 1.96811 153.961 1.56134C154.358 1.15457 154.844 0.951172 155.42 0.951172Z"
        fill="white"
      ></path>
    </mask>
    <g mask="url(#mask0)">
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M28.5771 -0.0478516H187.611V23.5587H28.5771V-0.0478516Z"
        fill="currentColor"
      ></path>
    </g>
    <mask
      id="mask1"
      style={{ maskType: "luminance" }}
      maskUnits="userSpaceOnUse"
      x="0"
      y="0"
      width="23"
      height="15"
    >
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M11.9677 0.194422L21.6396 6.36441C22.2164 6.73237 22.3857 7.49825 22.0178 8.07508C21.9208 8.22716 21.7917 8.35621 21.6396 8.45323L11.9677 14.6232C11.5614 14.8824 11.0416 14.8824 10.6352 14.6232L0.963345 8.45323C0.386536 8.08525 0.217233 7.31937 0.585198 6.74256C0.682214 6.59048 0.811269 6.46142 0.963345 6.36441L10.6352 0.194422C11.0416 -0.0648074 11.5614 -0.0648074 11.9677 0.194422Z"
        fill="white"
      ></path>
    </mask>
    <g mask="url(#mask1)">
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M-0.608398 -0.999023H23.2109V15.8162H-0.608398V-0.999023Z"
        fill="currentColor"
      ></path>
    </g>
    <mask
      id="mask2"
      style={{ maskType: "luminance" }}
      maskUnits="userSpaceOnUse"
      x="0"
      y="13"
      width="23"
      height="12"
    >
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M18.5593 13.7048L22.2285 16.2147C22.6049 16.4723 22.7014 16.9862 22.4438 17.3627C22.3786 17.458 22.2941 17.5386 22.1958 17.5993L11.73 24.056C11.4671 24.2182 11.1355 24.2201 10.8708 24.0608L0.400342 17.7635C0.00946997 17.5284 -0.116819 17.0209 0.11827 16.6301C0.175973 16.5341 0.252583 16.4509 0.34344 16.3855L4.04397 13.7211C4.31331 13.5272 4.67256 13.5133 4.95603 13.6859L10.9262 17.3208C11.1919 17.4825 11.526 17.4813 11.7904 17.3175L17.6582 13.6843C17.9362 13.5121 18.2894 13.5202 18.5593 13.7048Z"
        fill="white"
      ></path>
    </mask>
    <g mask="url(#mask2)">
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M-0.999023 12.5615H23.5867V25.1776H-0.999023V12.5615Z"
        fill="currentColor"
      ></path>
    </g>
  </svg>
);

const Navigation = async () => {
  const currentUser = await getCurrentUser();

  return (
    <>
      <MobileNavigation currentUser={currentUser} />
      <nav className="hidden items-center gap-2 text-sm font-medium text-neutral-700 md:flex md:gap-3">
        <Link
          href="/products"
          className="rounded-full px-3 py-1 transition hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-neutral-900 focus-visible:ring-offset-2"
        >
          Products
        </Link>
        <CartNavLink />
        {currentUser ? (
          <Link
            href="/wishlist"
            prefetch={false}
            className="rounded-full px-3 py-1 transition hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-neutral-900 focus-visible:ring-offset-2"
          >
            Wishlist
          </Link>
        ) : null}
        <Link
          href="/profile"
          prefetch={false}
          className="rounded-full px-3 py-1 transition hover:bg-neutral-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-neutral-900 focus-visible:ring-offset-2"
        >
          Profile
        </Link>
        {currentUser ? (
          <div className="flex items-center gap-2 rounded-full bg-neutral-100 px-3 py-1">
            <span
              className="hidden truncate text-xs font-semibold text-neutral-700 lg:inline lg:max-w-none"
              aria-label={`Logged in as ${currentUser.email}`}
              title={currentUser.email}
            >
              {currentUser.email}
            </span>
            <span
              className="truncate text-xs font-semibold text-neutral-700 md:inline lg:hidden"
              aria-label={`Logged in as ${currentUser.email}`}
              title={currentUser.email}
            >
              {currentUser.email.split("@")[0]}
            </span>
            <LogoutButton />
          </div>
        ) : (
          <Link
            href="/login"
            className="rounded-full bg-neutral-900 px-3 py-1 text-sm text-white transition hover:bg-neutral-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-neutral-900 focus-visible:ring-offset-2"
          >
            Login
          </Link>
        )}
      </nav>
    </>
  );
};

const RootLayout = async ({ children }) => {
  return (
    <html lang="en">
      <body className="min-h-dvh bg-gray-50 text-gray-900">
        <Providers>
          <HeaderBar>
            <Link
              href="/"
              className="flex shrink-0 items-center text-neutral-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-neutral-900 focus-visible:ring-offset-2"
              aria-label="Go to Mobiversite home"
            >
              <Logo />
            </Link>
            <Navigation />
          </HeaderBar>
          <div className="mx-auto max-w-6xl px-4">
            <main className="pt-20 pb-10 sm:pt-24 md:pt-28">{children}</main>
          </div>
        </Providers>
      </body>
    </html>
  );
};

export default RootLayout;
